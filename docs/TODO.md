# Passgate · 待完成计划 To-Do

> 依据 [PRD.md](./PRD.md)、[原型图_三页面.html](./原型图_三页面.html)、[PROJECT_STRUCTURE.md](./PROJECT_STRUCTURE.md) 整理

---

## 待完成项汇总（⬜ 共 10 项）

| 模块 | 待办 |
|------|------|
| 六、后端 | 无（均已完成） |
| 七、部署与上线 | 云服务器、Nginx、HTTPS、Docker、环境变量 |
| 八、测试与质量 | 后端测试、API 文档、E2E（可选） |
| 九、文档与规范 | 账号管理说明、运维手册 |

---

## 一、出票页面（Tab 1）

| 状态 | 任务 | 说明 |
|:----:|------|------|
| ✅ | 同手机号+同电影未核销票检查 | 出票前调用接口检查，有则 confirm 警告，可继续 |
| ✅ | 出票成功后自动滚动到二维码区域 | 展开二维码后 scrollIntoView |
| ✅ | 无可用电影时显示空态引导 | 引导用户先去「管理电影」新增 |
| ✅ | 电影字段校验 | 名称最长 30 字、备注最长 100 字 |
| ✅ | 电影下架入口 | 管理电影抽屉中为每部电影增加「下架」操作 |

---

## 二、管理电影

| 状态 | 任务 | 说明 |
|:----:|------|------|
| ✅ | 电影下架功能完善 | 前端入口 + 后端已有 deactivate 接口 |
| ✅ | 日期校验 | 结束日期须晚于开始日期（已做，可补充前端即时校验） |

---

## 三、出票历史

| 状态 | 任务 | 说明 |
|:----:|------|------|
| ✅ | 详情 Sheet 显示原始二维码 | 可长按保存补发 |
| ✅ | 分页 / 无限滚动 | 当前为单页拉取，支持分页加载更多 |
| ✅ | 下拉刷新 | 列表支持下拉刷新 |

---

## 四、检票页面（Tab 2）

| 状态 | 任务 | 说明 |
|:----:|------|------|
| ✅ | 摄像头权限拒绝引导 | Toast 提示用户去系统设置开启相机 |
| ✅ | 检票历史按日期范围筛选 | 支持选择日期区间筛选（后端 start_date/end_date + 前端下拉） |
| ✅ | 检票历史详情 Sheet | 点击记录显示完整详情（含核销时间、核销人、二维码） |

---

## 五、个人页面（Tab 3）

| 状态 | 任务 | 说明 |
|:----:|------|------|
| ✅ | 角色标签样式 | 管理员蓝色、员工灰色（对照原型） |

---

## 六、后端

| 状态 | 任务 | 说明 |
|:----:|------|------|
| ✅ | 出票前未核销票检查接口 | `GET /api/tickets/check-unused` 或类似，供前端 confirm |
| ✅ | 今日统计时区 | 配置 TIMEZONE=Asia/Shanghai，get_today_stats 使用 ZoneInfo |
| ✅ | 检票历史按日期筛选 | 支持 start_date、end_date 参数 |

---

## 七、部署与上线

> 详细步骤见 [TODO_DEPLOYMENT.md](./TODO_DEPLOYMENT.md)

| 状态 | 任务 | 说明 |
|:----:|------|------|
| ⬜ | 云服务器部署 | 2 核 2G 等配置 |
| ⬜ | Nginx 配置 | 前端静态 + 后端反向代理 |
| ⬜ | HTTPS | Let's Encrypt 证书（微信内 H5 扫码必需） |
| ⬜ | Docker 化（可选） | docker-compose 一键部署 |
| ⬜ | 环境变量与安全 | 生产环境 SECRET_KEY、数据库凭据等 |

---

## 八、测试与质量

| 状态 | 任务 | 说明 |
|:----:|------|------|
| ⬜ | 后端单元 / 集成测试 | pytest 覆盖核心接口 |
| ⬜ | API 文档 | FastAPI 自带 OpenAPI，可补充说明 |
| ⬜ | 前端 E2E 测试（可选） | 关键流程自动化 |

---

## 九、文档与规范

| 状态 | 任务 | 说明 |
|:----:|------|------|
| ⬜ | 工作人员账号管理说明 | 如何通过数据库新增/修改员工 |
| ⬜ | 运维手册 | 常见问题、日志查看、备份恢复 |

---

## 图例

- ⬜ 待完成
- 🔄 进行中
- ✅ 已完成

---

*最后更新：根据代码库实际完成状态重新梳理*
