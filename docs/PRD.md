# PRD · 电影院学生优惠票务系统 · 工作人员端 H5

**文档版本：** v1.2  
**最后更新：** 2026-02-24  
**适用范围：** 工作人员端 H5 全页面

---

## 目录

1. [项目背景与需求来源](#1-项目背景与需求来源)
2. [产品目标](#2-产品目标)
3. [用户与使用场景](#3-用户与使用场景)
4. [整体设计思路](#4-整体设计思路)
5. [全局说明](#5-全局说明)
6. [出票页面（Tab 1）](#6-出票页面tab-1)
7. [检票页面（Tab 2）](#7-检票页面tab-2)
8. [个人页面（Tab 3）](#8-个人页面tab-3)
9. [接口汇总](#9-接口汇总)
10. [数据库表结构](#10-数据库表结构)

---

## 1. 项目背景与需求来源

### 1.1 业务背景

电影院负责人希望面向学生群体不定期推出优惠票，通过微信群进行私域运营。由于该渠道属于非正规售票渠道，票务信息不会进入院线正规系统，完全依赖线下人工管理。

### 1.2 现有流程与痛点

**现有流程：**

1. 工作人员在微信群中发布每周优惠票信息
2. 学生看到后直接微信转账购票
3. 工作人员手动记录购票学生的手机号和票数（纸质或表格）
4. 学生到达现场后，工作人员手动核对名单，手工核销

**核心痛点：**

- **效率低：** 高峰期手工核对名单速度慢，排队等候体验差
- **易出错：** 纸质或表格记录容易遗漏，一票多用难以发现
- **无凭证：** 学生收到的只是口头或文字通知，没有正式凭证
- **管理盲区：** 无法追溯历史出票记录，谁出的票、核销了没有，全靠人工记忆

### 1.3 解决思路

在不接入正规售票系统的前提下，开发一套轻量内部工具：

- 工作人员收款后在系统中录入信息，系统自动生成带唯一标识的二维码，发给学生作为凭证
- 学生到场后工作人员扫码核销，系统自动判断有效性并更新状态
- 全程数字化，彻底替代手工记录和核对

---

## 2. 产品目标

| 目标 | 衡量指标 |
|------|---------|
| 提升核销效率 | 单次核销从逐一查表缩短为扫码即验，目标单次 < 5 秒 |
| 消除一票多用 | 同一二维码第二次扫描时系统自动拦截并提示 |
| 建立出票可追溯性 | 每张票记录出票人、时间、核销人、核销时间，可随时查询 |
| 降低操作门槛 | 工作人员无需任何培训，打开 H5 即可使用 |

---

## 3. 用户与使用场景

### 3.1 用户角色

**工作人员（普通员工）**
- 人数：固定几人，账号手动配置
- 使用场景：收到学生转账后立即出票，截图二维码发给学生；放映前在入口处扫码核销

**管理员**
- 人数：1～2 人（通常是负责人本人）
- 使用场景：同普通员工，额外可查看所有人的出票和核销记录

**学生（被动端，不使用本系统）**
- 只接收工作人员发来的二维码图片，到场时出示给工作人员扫描
- 无需下载任何 App，无需注册账号

### 3.2 核心使用流程

```
[微信群] 工作人员发布优惠票信息
         ↓
[线下] 学生转账购票
         ↓
[本系统·出票页] 工作人员选择电影 → 填入手机号和张数 → 生成二维码
         ↓
[微信] 工作人员截图二维码 → 发给学生
         ↓
[现场] 学生出示二维码图片
         ↓
[本系统·检票页] 工作人员点击扫码 → 扫描学生二维码 → 核销结果弹窗
         ↓
核销成功 → 学生入场
```

---

## 4. 整体设计思路

### 4.1 技术选型

| 层级 | 选型 | 原因 |
|------|------|------|
| 前端 | Vue 3 + Vant UI | 成熟移动端组件库，开发效率高 |
| 后端 | Node.js / Python FastAPI | 轻量，适合小规模内部工具 |
| 数据库 | MySQL | 关系型数据，票务状态管理清晰 |
| 部署 | 云服务器（2核2G，约100元/月） | 满足小规模使用 |
| HTTPS | Let's Encrypt 免费证书 | 微信内 H5 调用摄像头强制要求 HTTPS + 域名 |

### 4.2 形态选型：H5 而非小程序

- 学生侧无需任何操作，不需要小程序承载学生端
- 工作人员账号固定，无需注册体系
- 小程序上线需审核和企业资质，周期长；H5 部署即用
- 成本更低，无需小程序账号

### 4.3 二维码设计思路

二维码内容不明文存储业务信息，而是存储服务端生成的**唯一订单号**（如 `TK-20240315-A7X2K`）。

- **防伪：** 随机字符串无法枚举猜测
- **实时性：** 核销状态由服务端实时判断
- **轻量：** 内容短，扫描速度快

二维码图片由**后端生成**（Base64 返回），前端渲染展示，工作人员截图发给学生。

### 4.4 角色权限设计思路

系统只有两个角色，差异点仅在数据可见范围：

- 普通员工：只看自己操作的出票和核销记录
- 管理员：可看所有人的记录，历史列表额外显示"操作人"列

角色信息随登录 Token 下发，前端根据角色字段控制展示逻辑，无需独立管理后台。

### 4.5 票务状态流转

```
出票
 ↓
未核销 ──→ 已核销（扫码核销，终态，不可撤销）
 ↓
已作废（工作人员手动作废，终态，不可撤销）
```

两个终态均不可逆，保证数据简洁可信。

---

## 5. 全局说明

### 5.1 用户角色

| 角色 | 说明 | 账号管理方式 |
|------|------|------------|
| 普通员工 | 可出票、检票，历史只看自己的 | 手动数据库配置 |
| 管理员 | 全部权限，历史可看所有人的 | 手动数据库配置 |

### 5.2 登录机制

账号密码登录，Token 本地存储，有效期 7 天，到期跳转登录页。所有页面强制登录。

### 5.3 票务状态

| 状态 | 标签颜色 | 说明 |
|------|---------|------|
| 未核销 | 橙色 | 已出票，未到场 |
| 已核销 | 绿色 | 已核销，不可重复使用 |
| 已作废 | 红色 | 工作人员主动作废 |

### 5.4 底部 Tab 导航

出票 / 检票 / 个人，固定在页面底部。

---

## 6. 出票页面（Tab 1）

### 6.1 页面结构

```
┌─────────────────────────────────────┐
│  [管理电影]           出票      [历史] │
├─────────────────────────────────────┤
│  选择电影                            │
│  ┌───────────────────────────────┐  │
│  │  请选择电影  ▼                 │  │
│  └───────────────────────────────┘  │
│  学生手机号                          │
│  ┌───────────────────────────────┐  │
│  │  请输入手机号                  │  │
│  └───────────────────────────────┘  │
│  购票张数                            │
│  ┌───────────────────────────────┐  │
│  │  请输入张数（默认1）             │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │          生 成 二 维 码         │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

### 6.2 顶部导航栏

| 元素 | 位置 | 说明 |
|------|------|------|
| 管理电影 | 左上角 | 点击滑出左侧抽屉 |
| 出票 | 居中 | 静态标题 |
| 历史 | 右上角 | 跳转出票历史页 |

### 6.3 管理电影抽屉

从左侧滑入，顶部标题 + 关闭按钮，电影列表 + 底部"新增电影"按钮。

**新增 / 编辑电影 Modal 表单：**

| 字段 | 类型 | 必填 | 校验 |
|------|------|------|------|
| 电影名称 | 文本 | 是 | 最长 30 字 |
| 放映开始日期 | 日期选择器 | 是 | 精确到日 |
| 放映结束日期 | 日期选择器 | 是 | 晚于开始日期 |
| 优惠价格（元） | 数字 | 否 | 仅展示用 |
| 备注说明 | 多行文本 | 否 | 最长 100 字 |

**下架：** 下架后不出现在出票下拉中，已出未核销票不受影响。

### 6.4 出票表单字段

**选择电影：** 下拉 Picker，仅显示当前在有效期内且未下架的电影，副标题显示放映时间段。无可用电影时显示空态引导。

**学生手机号：** 数字键盘，必填，11 位，以 1 开头。

**购票张数：** 数字输入，1～10，默认 1，必填。

**生成二维码按钮逻辑：**
1. 前端校验，不通过则字段下方红字提示
2. 检查同手机号+同电影是否有未核销票，有则 confirm 警告（可继续）
3. 请求接口，按钮 Loading
4. 成功后展开二维码区域并自动滚动
5. 失败则 Toast"生成失败，请重试"

### 6.5 二维码展示区域

成功后展开显示：电影名、脱敏手机号（中间四位 `****`）、张数、有效期至、二维码图片（后端 Base64 返回）、提示"长按图片可保存或转发"、"继续出票"次级按钮。

### 6.6 出票历史页

**角色差异：**

| 角色 | 数据范围 | 出票人列 |
|------|---------|---------|
| 普通员工 | 仅自己 | 不显示 |
| 管理员 | 全部 | 显示 |

**列表：** 倒序，显示电影名、脱敏手机号、张数、出票时间、状态标签、出票人（管理员）。

**筛选：** 按电影、按状态（全部 / 未核销 / 已核销 / 已作废）。

**详情 Sheet：** 完整信息 + 原始二维码（可长按保存补发）+ 作废按钮（仅未核销时显示，点击 confirm 确认后作废）。

---

## 7. 检票页面（Tab 2）

### 7.1 页面结构

```
┌─────────────────────────────────────┐
│              检票          [历史]    │
├─────────────────────────────────────┤
│                                     │
│         ┌───────────────┐           │
│         │  📷  开始检票  │           │
│         └───────────────┘           │
│      点击按钮扫描学生二维码            │
│                                     │
└─────────────────────────────────────┘
```

### 7.2 开始检票按钮

页面中央大号按钮，摄像头图标 + "开始检票"文字。

**点击流程：**
1. 请求摄像头权限，拒绝则 Toast 引导去设置开启
2. 全屏扫码界面，中间扫描框，顶部"取消"按钮
3. 识别到二维码后关闭摄像头，弹出核销结果弹窗
4. 点确认后回到检票主页，可继续扫下一张

### 7.3 核销结果弹窗（5种情况）

| 情况 | 色调 | 核心信息 |
|------|------|---------|
| ✅ 核销成功 | 绿色 | 电影名、脱敏手机号、张数、出票时间 |
| ❌ 重复核销 | 红色 | 已核销时间、核销人 |
| ❌ 票已作废 | 红色 | 提示联系出票工作人员 |
| ❌ 票已过期 | 红色 | 电影名、有效期截止日期 |
| ❌ 无效二维码 | 红色 | 提示确认是否为正确票务码 |

### 7.4 检票历史页

**角色差异：**

| 角色 | 数据范围 | 核销人列 |
|------|---------|---------|
| 普通员工 | 仅自己 | 不显示 |
| 管理员 | 全部 | 显示 |

**列表：** 倒序，支持按电影、按日期范围筛选。点击记录显示完整详情 Sheet。

---

## 8. 个人页面（Tab 3）

### 8.1 页面结构

```
┌─────────────────────────────────────┐
│              个人                    │
├─────────────────────────────────────┤
│     👤  张三                         │
│         [管理员]                     │
├─────────────────────────────────────┤
│  今日出票：12 张     今日核销：8 张    │
├─────────────────────────────────────┤
│  修改密码                        >   │
│  退出登录                        >   │
└─────────────────────────────────────┘
```

### 8.2 个人信息区

默认头像图标 + 姓名 + 角色标签（管理员蓝色 / 员工灰色）。

### 8.3 今日数据

显示当前账号今日出票张数和核销张数（仅统计本人操作）。

### 8.4 修改密码

| 字段 | 校验 |
|------|------|
| 当前密码 | 后端校验 |
| 新密码 | 最少 6 位 |
| 确认新密码 | 与新密码一致 |

成功后 Toast 提示，自动返回，Token 不失效。

### 8.5 退出登录

confirm 确认后清除 Token，跳转登录页。

---

## 9. 接口汇总

### 认证

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/auth/login` | POST | 账号密码登录，返回 Token 和角色 |
| `/api/auth/change-password` | POST | 修改密码 |

### 电影促销

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/movies/active` | GET | 获取当前有效电影列表 |
| `/api/movies` | GET | 获取所有电影（管理用） |
| `/api/movies` | POST | 新增电影促销 |
| `/api/movies/:id` | PUT | 编辑电影促销 |
| `/api/movies/:id/deactivate` | POST | 下架电影 |

### 票务

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/tickets` | POST | 出票，返回 ticket_code 和二维码 Base64 |
| `/api/tickets` | GET | 出票历史，角色控制范围，支持分页筛选 |
| `/api/tickets/:id/void` | POST | 作废票务，仅限未核销状态 |
| `/api/tickets/verify` | POST | 核销，传入 ticket_code，返回结果和详情 |
| `/api/tickets/check-history` | GET | 检票历史，角色控制范围，支持分页筛选 |

### 统计

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/stats/today` | GET | 当前账号今日出票和核销张数 |

---

## 10. 数据库表结构

**staff（工作人员）**

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT PK | |
| username | VARCHAR | 登录账号 |
| password_hash | VARCHAR | 加密存储 |
| name | VARCHAR | 显示姓名 |
| role | ENUM | admin / staff |
| created_at | DATETIME | |

**movies（电影促销）**

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT PK | |
| name | VARCHAR | 电影名称 |
| start_date | DATE | 放映开始日期 |
| end_date | DATE | 放映结束日期 |
| price | DECIMAL | 优惠价格，可为空 |
| remark | VARCHAR | 备注 |
| is_active | TINYINT | 1 正常 / 0 下架 |
| created_by | INT FK | 创建人 staff.id |
| created_at | DATETIME | |

**tickets（票务）**

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT PK | |
| ticket_code | VARCHAR | 唯一订单号，二维码内容 |
| movie_id | INT FK | |
| phone | VARCHAR | 学生手机号 |
| quantity | INT | 购票张数 |
| status | ENUM | unused / used / voided |
| issuer_id | INT FK | 出票人 staff.id |
| issued_at | DATETIME | 出票时间 |
| checker_id | INT FK | 核销人，可为空 |
| checked_at | DATETIME | 核销时间，可为空 |
| voided_by | INT FK | 作废人，可为空 |
| voided_at | DATETIME | 作废时间，可为空 |

---

*文档结束 · v1.2*
